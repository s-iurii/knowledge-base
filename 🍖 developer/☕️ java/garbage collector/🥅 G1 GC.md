 [[⛳️ Garbage Collector]]

### Преимущества и недостатки G1 GC

**Преимущества**:

- **Предсказуемое время пауз**: возможность управлять паузами GC.
- **Хорошо масштабируется на большие хипы**: особенно полезен в средах с большими объемами памяти.
- **Конкурентные фазы**: минимизация пауз, так как большинство работы выполняется параллельно с работой приложения.

**Недостатки**:

- **Может быть менее эффективным при очень низких значениях времени пауз**: в некоторых случаях другие GC могут дать более короткие паузы.
- **Сложность настройки**: правильная настройка G1 GC для конкретного приложения может требовать времени и экспериментов.

G1 (Garbage First) GC — это сборщик мусора, который был разработан как замена для существующих сборщиков мусора, таких как Parallel GC и CMS (Concurrent Mark-Sweep), особенно для больших хипов (heap) и серверных приложений, требующих низких пауз. G1 был разработан для обеспечения предсказуемых пауз при сборке мусора, минимизируя влияние на производительность.

### Основные характеристики G1 GC

1. **Регионы памяти**
    
    - В отличие от традиционных сборщиков мусора, которые делят кучу на молодое и старое поколения, G1 делит память на более мелкие, одинаково размеренные регионы (обычно от 1 до 32 МБ).
    - Эти регионы могут динамически изменять свое назначение, то есть могут использоваться для Eden, Survivor, или Old generations по мере необходимости.
2. **Garbage-First (G1) алгоритм**
    
    - Основная цель G1 — сбор мусора с минимальными паузами. Для этого он сначала собирает регионы, содержащие наибольшее количество мусора, тем самым минимизируя количество данных, которые нужно перемещать или копировать.
    - Это «первый мусор» (Garbage-First) подход обеспечивает более предсказуемые паузы, чем у других сборщиков.
3. **Молодое и старое поколения**
    
    - G1 сохраняет разделение кучи на молодое (Young) и старое (Old) поколения, но работа с ними более гибкая благодаря регионам.
    - Объекты, которые переживают несколько циклов сборки мусора, перемещаются из молодого поколения в старое (то есть они становятся "старшими").
4. **Concurrent Marking (Конкурентная маркировка)**
    
    - G1 использует фазу конкурентной маркировки (Concurrent Marking) для выявления областей старого поколения, которые больше не используются. Эта фаза работает параллельно с приложением, минимизируя паузы.
    - Когда определяется, что определенные регионы содержат только мертвые объекты, они помечаются для повторного использования.
5. **Mixed GC (Смешанная сборка мусора)**
    
    - После завершения фазы конкурентной маркировки G1 выполняет "смешанные" сборки мусора, в которых он собирает как молодые регионы, так и некоторые регионы старого поколения. Это помогает поддерживать старое поколение в управляемых размерах без выполнения полного GC (Full GC).
6. **Обратное давление (Backpressure)**
    
    - G1 GC обеспечивает механизмы для управления нагрузкой через обратное давление. Это позволяет сборщику мусора адаптироваться к изменяющимся условиям работы приложения и нагрузке на систему.
7. **Predictable Pause Times (Предсказуемое время пауз)**
    
    - Одной из ключевых характеристик G1 GC является его способность предсказывать время пауз. Разработчик может задать максимальное целевое время паузы, и G1 будет стараться соблюдать этот лимит, что делает его предпочтительным выбором для систем с высокими требованиями к производительности.

### Конфигурация G1 GC

G1 GC позволяет настроить параметры его работы через JVM параметры:

- **`-XX:MaxGCPauseMillis=<N>`**: задает целевое максимальное время паузы в миллисекундах. G1 будет стараться придерживаться этого значения.
- **`-XX:InitiatingHeapOccupancyPercent=<N>`**: процент заполненности кучи, при котором запускается сборка старого поколения. По умолчанию 45%.
- **`-XX:G1HeapRegionSize=<N>`**: задает размер региона в байтах. Этот размер должен быть кратен степени двойки (например, 1MB, 2MB, 4MB и т. д.).
- **`-XX:ConcGCThreads=<N>`**: количество потоков, используемых для конкурентной маркировки.
- **`-XX:ParallelGCThreads=<N>`**: количество потоков, используемых для параллельной сборки мусора в молодых поколениях.

